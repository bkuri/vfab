#compdef plotty
# Zsh completion for ploTTY
_plotty() {
    local context state line
    
    _arguments -C \
        '(-h --help)'{-h,--help}'[Show help]' \
        '--version[Show version and exit]' \
        '1: :->command'
    
    case $state in
        command)
            local -a commands
            commands=(
                'interactive:Start an interactive plot'
                'optimize:Optimize jobs for plotting'
                'plan:Plan a job for plotting'
                'queue:Queue a job for plotting'
                'resume:Resume interrupted plotting jobs'
                'restart:Restart job from beginning'
                'setup:Run setup wizard'
                'start:Start plotting a job'
                'plot:Plot a job'
                'add:Add new files'
                'check:System and device checking'
                'info:Status and monitoring commands'
                'list:List and manage resources'
                'remove:Remove resources'
                'stats:Statistics and analytics'
                'system:System management commands'
            )
            _describe 'plotty commands' commands
            ;;
    esac
    
    # Handle subcommands
    case $words[2] in
        add)
            _plotty_add
            ;;
        check)
            _plotty_check
            ;;
        info)
            _plotty_info
            ;;
        list)
            _plotty_list
            ;;
        remove)
            _plotty_remove
            ;;
        stats)
            _plotty_stats
            ;;
        system)
            _plotty_system
            ;;
        start|plot)
            _plotty_plot
            ;;
        optimize)
            _plotty_optimize
            ;;
        plan)
            _plotty_plan
            ;;
        interactive)
            _plotty_interactive
            ;;
        resume)
            _plotty_resume
            ;;
        restart)
            _plotty_restart
            ;;
    esac
}

_plotty_add() {
    local -a subcommands
    subcommands=(
        'job:Add a new job'
        'jobs:Add multiple jobs using pattern'
        'pen:Add a new pen configuration'
        'paper:Add a new paper configuration'
    )
    _describe 'plotty add commands' subcommands
}

_plotty_check() {
    local -a subcommands
    subcommands=(
        'camera:Test camera connectivity'
        'config:Check configuration'
        'job:Check job status and guards'
        'ready:Check overall system readiness'
        'self:Run comprehensive self-tests'
        'servo:Test servo motor operation'
        'timing:Test device timing'
    )
    _describe 'plotty check commands' subcommands
}

_plotty_info() {
    local -a subcommands
    subcommands=(
        'system:Show overall system status'
        'tldr:Quick overview of system and queue'
        'job:Show detailed information about a specific job'
        'reset:Reset the current session'
        'session:Show current session information'
        'queue:Show job queue status'
    )
    _describe 'plotty info commands' subcommands
    _arguments \
        '--json[Export as JSON]' \
        '--csv[Export as CSV]'
}

_plotty_list() {
    local -a subcommands
    subcommands=(
        'pens:List available pen configurations'
        'papers:List available paper configurations'
        'presets:List available plot presets'
        'jobs:List all jobs in workspace'
        'guards:List available guards'
    )
    _describe 'plotty list commands' subcommands
}

_plotty_remove() {
    local -a subcommands
    subcommands=(
        'pen:Remove a pen configuration'
        'paper:Remove a paper configuration'
        'job:Remove a job'
        'jobs:Remove multiple jobs with filtering'
    )
    _describe 'plotty remove commands' subcommands
}

_plotty_stats() {
    local -a subcommands
    subcommands=(
        'summary:Show overall statistics summary'
        'jobs:Show job-related statistics'
        'performance:Show performance metrics and trends'
    )
    _describe 'plotty stats commands' subcommands
    _arguments \
        '--json[Export as JSON]' \
        '--csv[Export as CSV]'
}

_plotty_system() {
    local -a subcommands
    subcommands=(
        'export:Export and backup operations'
        'import:Import and restore operations'
        'logs:Log management commands'
        'stats:Statistics and analytics'
    )
    _describe 'plotty system commands' subcommands
}

_plotty_plot() {
    _arguments \
        '(-p --preset)'{-p,--preset}'[Plot preset]:preset:(fast safe preview detail draft)' \
        '--port[Device port]:port:' \
        '--model[Device model]:model:(1)' \
        '--apply[Start plotting]' \
        '--dry-run[Preview plotting without moving pen]'
}

_plotty_optimize() {
    _arguments \
        '(-p --preset)'{-p,--preset}'[Optimization preset]:preset:(fast default hq)' \
        '(-d --digest)'{-d,--digest}'[Digest level]:level:(0 1 2)' \
        '--apply[Actually perform optimization]'
}

_plotty_plan() {
    _arguments \
        '(-p --pen)'{-p,--pen}'[Default pen specification]:pen:' \
        '(-i --interactive)'{-i,--interactive}'[Interactive layer planning]'
}

_plotty_interactive() {
    _arguments \
        '--port[Device port]:port:' \
        '--model[Device model]:model:(1)' \
        '--units[Coordinate units]:units:(inches millimeters centimeters)'
}

_plotty_resume() {
    _arguments \
        '--apply[Apply resume changes]'
}

_plotty_restart() {
    _arguments \
        '--apply[Apply restart changes]' \
        '--now[Move job to front of queue]' \
        '--json[Output in JSON format]'
}
